# コンビニ新着商品自動収集・LINE配信システム

## 概要

セブンイレブン、ファミリーマート、ローソンの3社のHPを週1回自動巡回し、新着商品から高タンパク低脂質の商品を自動抽出して、LINE公式アカウントにカード形式で配信するシステムです。

健康志向のユーザーが、コンビニの新着商品を手動で確認する手間を削減し、自分に必要な商品だけを効率的に知ることができるソリューションです。

## システム構成

```
┌─────────────────────────────────────┐
│  定期実行トリガー (週1回)            │
│  (cron/GAS/n8nのいずれか)            │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  スクレイピング処理 (Python)         │
│  ├─→ セブンイレブンHP                │
│  ├─→ ファミリーマートHP              │
│  └─→ ローソンHP                      │
│      └─→ 新着商品情報の取得          │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  データ処理・フィルタリング (Python) │
│  ├─→ 栄養成分データの抽出            │
│  ├─→ 高タンパク低脂質商品の判定      │
│  └─→ 商品リストの生成                │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  LINEメッセージ生成 (Python)         │
│  └─→ カード型メッセージの生成        │
│      (商品名、栄養成分、リンク)       │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  LINE配信 (LINE Messaging API)       │
│  └─→ LINE公式アカウントに配信        │
└─────────────────────────────────────┘
```

## 主な機能

1. **3社HPの自動巡回**
   - セブンイレブン、ファミリーマート、ローソンの新着商品ページを自動で取得
   - 週1回の定期実行による自動化

2. **高タンパク低脂質商品の自動抽出**
   - 栄養成分データから条件に合う商品を自動判定
   - フィルタリングロジックによる効率的な抽出

3. **LINEカード型メッセージ配信**
   - 商品情報をカード形式で見やすく表示
   - 商品ページへのリンク付き
   - 栄養成分情報の表示

## 技術スタック

- **スクレイピング**: Python (BeautifulSoup/Selenium/Playwright)
- **データ処理**: Python (pandas/numpy - オプション)
- **定期実行**: cron/GAS/n8n (いずれか)
- **LINE連携**: LINE Messaging API
- **環境**: Python 3.x

## ファイル構成

```
convenience-store-product-system/
├── README.md                    # このファイル
├── requirements.txt             # Python依存関係
├── env.example                  # 環境変数のサンプル
├── scripts/
│   ├── scraper.py               # スクレイピングスクリプト
│   │   ├── scrape_seven.py      # セブンイレブン
│   │   ├── scrape_family.py     # ファミリーマート
│   │   └── scrape_lawson.py     # ローソン
│   ├── filter_products.py       # 商品フィルタリング
│   ├── line_sender.py           # LINE送信スクリプト
│   └── main.py                  # メインワークフロー実行
└── config/
    └── filter_config.json       # フィルタリング条件設定
```

## セットアップ手順

### 1. 環境変数の設定

```bash
cp env.example .env
```

`.env`ファイルを編集して、LINE Messaging APIの認証情報を設定してください。

```env
LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token
LINE_USER_ID=your_user_id
```

### 2. Python環境のセットアップ

```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 3. フィルタリング条件の設定

`config/filter_config.json`を編集して、高タンパク低脂質の基準を設定してください。

```json
{
  "protein_min": 20,
  "fat_max": 10,
  "unit": "g"
}
```

### 4. 定期実行の設定

#### cronを使用する場合 (Linux/Mac)

```bash
# 毎週月曜日の朝9時に実行
0 9 * * 1 cd /path/to/convenience-store-product-system && python scripts/main.py
```

#### Google Apps Script (GAS) を使用する場合

GASで週1回のトリガーを設定し、Cloud Functionsまたは外部API経由でスクリプトを呼び出します。

#### n8nを使用する場合

n8nワークフローで週1回のスケジュールを設定し、HTTPリクエストでスクリプトを実行します。

## 使用方法

### 手動実行

```bash
# メインワークフローを実行
python scripts/main.py
```

### 定期実行

上記のセットアップ手順に従って、cron/GAS/n8nで定期実行を設定してください。

## フィルタリングロジック

高タンパク低脂質商品の判定基準：

- **高タンパク**: タンパク質が指定値以上（デフォルト: 20g以上）
- **低脂質**: 脂質が指定値以下（デフォルト: 10g以下）

これらの基準は`config/filter_config.json`で調整可能です。

## LINEメッセージ形式

### カード型メッセージ

- **商品名**: 商品名を表示
- **栄養成分**: タンパク質、脂質、カロリーなどの主要な栄養成分
- **リンク**: 商品ページへのリンク
- **画像**: 商品画像（取得可能な場合）

## 注意事項

### スクレイピングに関する注意

- **robots.txt遵守**: 各コンビニHPのrobots.txtを確認し、遵守してください
- **レート制限**: サーバーに負荷をかけないよう、適切な待機時間を設定してください
- **エラーハンドリング**: サイト構造の変更に対応できるよう、エラーハンドリングを実装してください
- **利用規約**: 各コンビニHPの利用規約を確認し、スクレイピングが許可されていることを確認してください

### LINE Messaging APIに関する注意

- **送信制限**: 無料プランでは月500メッセージの制限があります
- **エラーハンドリング**: APIエラー時のリトライロジックを実装してください
- **プライバシー**: 個人情報の取り扱いには注意してください

### 定期実行に関する注意

- **実行ログ**: 実行履歴を記録し、問題が発生した際に確認できるようにしてください
- **エラー通知**: 実行失敗時に通知を送る仕組みを実装することを推奨します

## 今後の拡張可能性

- **他のコンビニチェーンへの対応**: ミニストップ、デイリーヤマザキなど
- **フィルタリング条件のカスタマイズ**: ユーザーごとの設定に対応
- **配信スケジュールの柔軟化**: 週1回以外の頻度への対応
- **データベースへの保存**: 商品履歴の保存・分析
- **Webダッシュボード**: 配信状況の可視化

## ライセンス

MIT License

---

## 実績・技術的な特徴

このシステムは以下の技術的な特徴を持っています：

- **マルチサイトスクレイピング**: 3つの異なるサイト構造に対応したスクレイピング実装
- **データフィルタリング**: 栄養成分データに基づく自動フィルタリング
- **LINEカード型メッセージ**: ユーザーフレンドリーな情報提示
- **定期実行の自動化**: 継続的な情報収集・配信の自動化

これらの技術は、他の業務自動化案件にも応用可能です。

